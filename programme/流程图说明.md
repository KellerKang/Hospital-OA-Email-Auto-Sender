# 自动化数据提取与邮件发送系统流程图

## 系统流程图

```
开始
  ↓
[配置检查]
  ↓
[连接Oracle数据库]
  ↓
[执行SQL查询]
  ↓
[提取数据]
  ↓
[保存为Excel文件]
  ↓
[生成带时间戳的文件名]
  ↓
[保存到D盘指定目录]
  ↓
[启动Chrome浏览器]
  ↓
[访问OA系统登录页面]
  ↓
[自动填写用户名密码]
  ↓
[登录OA系统]
  ↓
[导航到邮件发送页面]
  ↓
[点击写邮件按钮]
  ↓
[填写收件人列表]
  ↓
[填写邮件主题]
  ↓
[填写邮件正文]
  ↓
[上传Excel附件]
  ↓
[点击发送按钮]
  ↓
[检查发送结果]
  ↓
[关闭浏览器]
  ↓
[记录执行日志]
  ↓
结束
```

## 详细流程说明

### 1. 数据提取阶段
- **数据库连接**: 使用cx_Oracle连接Oracle数据库
- **查询执行**: 执行预定义的SQL查询语句
- **数据处理**: 将查询结果转换为pandas DataFrame
- **文件保存**: 使用openpyxl保存为格式化的Excel文件

### 2. 邮件发送阶段
- **浏览器自动化**: 使用Selenium WebDriver控制Chrome浏览器
- **OA系统登录**: 自动填写登录信息并提交
- **邮件编写**: 自动填写收件人、主题、正文
- **附件上传**: 自动上传生成的Excel文件
- **邮件发送**: 自动点击发送按钮

### 3. 定时执行阶段
- **任务创建**: 使用Windows计划任务创建每日定时任务
- **自动运行**: 系统在指定时间自动执行完整流程
- **日志记录**: 记录每次执行的详细日志信息

## 错误处理机制

### 数据库连接错误
- 重试机制
- 连接超时处理
- 详细的错误日志记录

### 邮件发送错误
- 网络连接检查
- 页面元素等待机制
- 发送失败重试

### 文件操作错误
- 目录权限检查
- 文件占用处理
- 磁盘空间检查

## 监控和日志

### 日志级别
- INFO: 正常流程信息
- WARNING: 警告信息
- ERROR: 错误信息
- DEBUG: 调试信息

### 日志内容
- 执行时间戳
- 操作步骤
- 错误详情
- 性能指标

## 配置管理

### 数据库配置
- 主机地址
- 端口号
- 服务名
- 用户名密码

### 邮件配置
- OA系统地址
- 登录凭据
- 收件人列表
- 邮件模板

### 文件配置
- 输出目录
- 文件命名规则
- 文件格式设置 